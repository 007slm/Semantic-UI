(function(e,n,t,o){e.dimScreen=function(n){var t="function"==typeof n?e.extend({},e.fn.modal.settings,{dim:n}):e.extend({},e.fn.modal.settings,n),o=e(t.context),i=o.children(t.selector.dimmer),a=i.size()>0,s=i.css("opacity");return a||(i=e("<div/>").attr("id","dimmer").html('<div class="content"></div>'),o.append(i)),s!=t.opacity&&(i.one("click",function(){t.unDim(),e.unDimScreen()}),0===t.duration?(i.css({visibility:"visible"}).find(".content").css({opacity:t.opacity,visibility:"visible"}),t.dim()):i.css({visibility:"visible"}).find(".content").css({opacity:0,visibility:"visible"}).fadeTo(t.duration,t.opacity,t.dim)),this},e.unDimScreen=function(n){var t="function"==typeof n?e.extend({},e.fn.modal.settings,{unDim:n}):e.extend({},e.fn.modal.settings,n),o=e(t.context),i=o.children(t.selector.dimmer),a=i.size()>0;return a&&(t.unDim(),0===t.duration?i.css({visibility:"hidden"}).remove():i.find(".content").fadeTo(t.duration,0,function(){i.remove()})),this},e.fn.modal=function(i){var a,s=e.extend(!0,{},e.fn.modal.settings,i),r=arguments[0],c=[].slice.call(arguments,1);return e(this).each(function(){var i,l=e(this),d=l.find(s.selector.closeButton),u=(e(s.context).find(s.selector.dimmer),e(s.context).children(s.selector.modal)),m=u.not(l),f=l.data("module-"+s.namespace),g="string"==typeof r,p=(s.className,s.namespace);i={initialize:function(){l.on("modalShow."+p,i.show).on("modalHide."+p,i.hide).data("module-"+p,i)},show:function(){var i=l.outerHeight(),a=e(n).height(),r=i>a,c=r?"absolute":"fixed",u=r?"0":"50%",f=r?a/8:-((i-s.closeSpacing)/2),g="absolute"==l.css("position")?f+e(n).prop("pageYOffset"):f,h=g+s.animationOffset;e.fn.popIn!==o?l.addClass(c).css({display:"block",opacity:0,top:u,marginTop:g+"px"}).popIn():l.addClass(c).css({display:"block",opacity:0,top:u,marginTop:h+"px"}).animate({opacity:1,marginTop:g+"px"},s.duration+300,s.easing),m.is(":visible")&&m.filter(":visible").hide(),console.log("zzz"),e.dimScreen({context:s.context,duration:0,dim:function(){console.log("aaa"),e(t).on("keyup."+p,function(e){var n=e.which,t=27;switch(n){case t:l.modal("hide"),e.preventDefault()}}),console.log(d),console.log("attaching click"),d.one("click",function(){l.modal("hide")}),s.dim()},unDim:function(){l.modal("hide"),d.unbind("click")}})},hide:function(){e(t).off("keyup."+p),e.unDimScreen({duration:0,unDim:function(){l.popOut(200),s.unDim()}})},setting:function(e,n){return n===o?s[e]:(s[e]=n,o)},debug:function(){var e=[],n=s.moduleName+": "+arguments[0],t=[].slice.call(arguments,1),o=console.info||console.log||function(){};s.debug&&(e.push(n),o.apply(console,e.concat(t)))},error:function(){var e=[],n=s.moduleName+": "+arguments[0],t=[].slice.call(arguments,1),o=console.warn||console.log||function(){};s.debug&&(e.push(n),e.concat(t),o.apply(console,e.concat(t)))},invoke:function(n,t,a){var r,c;return a=a||[].slice.call(arguments,2),"string"==typeof n&&f!==o&&(n=n.split("."),r=n.length-1,e.each(n,function(n,t){return e.isPlainObject(f[t])&&n!=r?(f=f[t],!0):f[t]!==o?(c=f[t],!0):(i.error(s.errors.method),!1)})),e.isFunction(c)?c.apply(t,a):c}},g?a=i.invoke(r,this,c):i.initialize()}),a!==o?a:this},e.fn.modal.settings={moduleName:"Modal",debug:!1,namespace:"modal",errors:{method:"The method you called is not defined"},dim:function(){},unDim:function(){},hide:function(){},show:function(){},context:"body",opacity:.8,closeSpacing:25,animationOffset:15,duration:400,easing:"easeOutExpo",selector:{dimmer:"#dimmer",modal:".modal",closeButton:".close"}}})(jQuery,window,document);