(function(e,t,n,i){e.fn.form=function(t,n){var o,a=e(this),r=e.extend(!0,{},e.fn.form.settings,n),s=e.extend({},e.fn.form.settings.defaults,t),l="."+r.namespace,c=("module-"+r.namespace,a.selector||""),u=(new Date).getTime(),d=[],f=arguments[0],m="string"==typeof f,p=[].slice.call(arguments,1);return a.each(function(){var t,n=e(this),g=e(this).find(r.selector.field),h=e(this).find(r.selector.group),v=e(this).find(r.selector.message),y=(e(this).find(r.selector.prompt),e(this).find(r.selector.submit)),b=[],x=this,w=n.data("module-"+r.namespace),C=r.namespace,z=r.metadata,k=r.className,T=r.error;t={initialize:function(){t.verbose("Initializing form validation",n,s,r),r.keyboardShortcuts&&g.on("keydown"+l,t.event.field.keydown),n.on("submit"+l,t.validate.form),g.on("blur"+l,t.event.field.change),y.on("click"+l,t.submit)},destroy:function(){n.off(C)},refresh:function(){g=n.find(r.selector.field)},submit:function(){t.verbose("Submitting form",n),n.submit()},event:{field:{keydown:function(n){var o=e(this),a=n.which,s={enter:13,escape:27};return a==s.escape&&(t.verbose("Escape key pressed blurring field"),o.blur()),a==s.enter&&o.is(r.selector.input)?(t.debug("Enter key pressed, submitting form"),y.addClass(k.down),o.one("keyup"+l,t.event.field.keyup),n.preventDefault(),!1):i},keyup:function(){t.verbose("Doing keyboard shortcut form submit"),y.removeClass(k.down),t.submit()},change:function(){var n=e(this),i=n.closest(h);console.log("here",r.on),i.hasClass(k.error)?(t.debug("Revalidating field",n,t.get.validation(n)),t.validate.field(t.get.validation(n))):"change"==r.on&&t.validate.field(t.get.validation(n))}}},get:{field:function(n){return t.verbose("Finding field with identifier",n),g.filter("#"+n).size()>0?g.filter("#"+n):g.filter('[name="'+n+'"]').size()>0?g.filter('[name="'+n+'"]'):g.filter("[data-"+z.validate+'="'+n+'"]').size()>0?g.filter("[data-"+z.validate+'="'+n+'"]'):e("<input/>")},validation:function(n){var i;return e.each(s,function(e,o){t.get.field(o.identifier).get(0)==n.get(0)&&(i=o)}),i||!1}},has:{field:function(e){return t.verbose("Checking for existence of a field with identifier",e),g.filter("#"+e).size()>0?!0:g.filter('[name="'+e+'"]').size()>0?!0:g.filter("[data-"+z.validate+'="'+e+'"]').size()>0?!0:!1}},add:{prompt:function(e,n){var i=t.get.field(e.identifier),o=i.closest(h),a=o.find(r.selector.prompt),s=0!==a.size();t.verbose("Adding inline validation prompt"),o.addClass(k.error),r.inlineError&&(s||(a=r.templates.prompt(n),a.appendTo(o).hide()),a.html(n[0]),a.is(":not(:visible)")&&a.fadeIn(r.animateSpeed))},errors:function(e){t.debug("Adding form error messages",e),v.html(r.templates.error(e))}},remove:{prompt:function(e){var n=t.get.field(e.identifier),i=n.closest(h),o=i.find(r.selector.prompt);i.removeClass(k.error),r.inlineError&&o.hide()}},validate:{form:function(i){var o=!0;b=[],e.each(s,function(e,n){t.validate.field(n)||(o=!1)}),o?(n.removeClass(k.error).addClass(k.success),e.proxy(r.onSuccess,this)(i)):(n.addClass(k.error),r.inlineError||t.add.errors(b),e.proxy(r.onFailure,this)(b))},field:function(n){var o=t.get.field(n.identifier),a=!0,s=[];return n.rules!==i&&e.each(n.rules,function(e,i){t.has.field(n.identifier)&&!t.validate.rule(n,i)&&(t.debug("Field is invalid",n.identifier,i.type),s.push(i.prompt),a=!1)}),a?(t.remove.prompt(n,s),e.proxy(r.onValid,o)(),!0):(b=b.concat(s),t.add.prompt(n,s),e.proxy(r.onInvalid,o)(s),!1)},rule:function(o,a){var s,l,c=t.get.field(o.identifier),u=a.type,d=c.val(),f=/\[(.*?)\]/i,m=f.exec(u),p=!0;return m!==i&&null!=m?(s=m[1],l=u.replace(m[0],""),p=e.proxy(r.rules[l],n)(d,s)):p="checked"==u?c.filter(":checked").size()>0:r.rules[u](d),p}},setting:function(t,n){return n===i?r[t]:(e.isPlainObject(t)?e.extend(!0,r,t):r[t]=n,i)},internal:function(n,o){return o===i?t[n]:(e.isPlainObject(n)?e.extend(!0,t,n):t[n]=o,i)},debug:function(){r.debug&&(r.performance?t.performance.log(arguments):t.debug=Function.prototype.bind.call(console.info,console,r.moduleName+":"))},verbose:function(){r.verbose&&r.debug&&(r.performance?t.performance.log(arguments):t.verbose=Function.prototype.bind.call(console.info,console,r.moduleName+":"))},error:function(){t.error=Function.prototype.bind.call(console.log,console,r.moduleName+":")},performance:{log:function(e){var n,i,o;r.performance&&(n=(new Date).getTime(),o=u||n,i=n-o,u=n,d.push({Element:x,Name:e[0],Arguments:e[1]||"None","Execution Time":i}),clearTimeout(t.performance.timer),t.performance.timer=setTimeout(t.performance.display,100))},display:function(){var t=r.moduleName,n=(r.moduleName+": "+c+"("+a.size()+" elements)",0);c&&(t+=" Performance ("+c+")"),(console.group!==i||console.table!==i)&&d.length>0&&(console.groupCollapsed(t),console.table?(e.each(d,function(e,t){n+=t["Execution Time"]}),console.table(d)):e.each(d,function(e,t){n+=t["Execution Time"],console.log(t.Name+": "+t["Execution Time"]+"ms")}),console.log("Total Execution Time:",n+"ms"),console.groupEnd(),d=[],u=!1)}},invoke:function(n,o,a){var r,s;return o=o||p,a=x||a,"string"==typeof n&&w!==i&&(n=n.split("."),r=n.length-1,e.each(n,function(n,o){e.isPlainObject(w[o])&&n!=r?w=w[o]:w[o]!==i?s=w[o]:t.error(T.method)})),e.isFunction(s)?(w.verbose("Executing invoked function",s),s.apply(a,o)):s||!1}},m?(w===i&&t.initialize(),o=t.invoke(f)):(w!==i&&t.destroy(),t.initialize())}),o?o:this},e.fn.form.settings={moduleName:"Form",debug:!0,verbose:!0,performance:!1,namespace:"validate",keyboardShortcuts:!0,on:"submit",animateSpeed:150,inlineError:!1,onValid:function(){},onInvalid:function(){},onSuccess:function(){return!0},onFailure:function(){return!1},metadata:{validate:"validate"},selector:{message:".error.message",field:"input, textarea, select",group:".field",input:"input",prompt:".prompt",submit:".submit"},className:{error:"error",success:"success",down:"down",label:"ui label prompt"},error:{method:"The method you called is not defined."},templates:{error:function(t){var n='<ul class="list">';return e.each(t,function(e,t){n+="<li>"+t+"</li>"}),n+="</ul>",e(n)},prompt:function(t){return e("<div/>").addClass("ui red pointing prompt label").html(t[0])}},rules:{empty:function(e){return!(e===i||""===e)},email:function(e){var t=RegExp("[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?");return t.test(e)},length:function(e,t){return e!==i?e.length>=t:!1},not:function(e,t){return e!=t},is:function(e,t){return e==t},maxLength:function(e,t){return e!==i?t>=e.length:!1},match:function(t,n){var o,a=e(this);return a.find("#"+n).size()>0?o=a.find("#"+n).val():a.find("[name="+n+"]").size()>0?o=a.find("[name="+n+"]").val():a.find('[data-validate="'+n+'"]').size()>0&&(o=a.find('[data-validate="'+n+'"]').val()),o!==i?""+t==""+o:!1},url:function(e){var t=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return t.test(e)}}}})(jQuery,window,document);