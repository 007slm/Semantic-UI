(function(e,t,n,o){e.fn.colorize=function(t){var n=e.extend(!0,{},e.fn.colorize.settings,t),i=arguments||!1;return e(this).each(function(t){var a,r,s,c,l,u,d,g,f=e(this),m=e("<canvas />")[0],p=e("<canvas />")[0],h=e("<canvas />")[0],y=new Image,v=n.colors,x=(n.paths,n.namespace),b=n.errors,w=f.data("module-"+x);return g={checkPreconditions:function(){return g.debug("Checking pre-conditions"),!e.isPlainObject(v)||e.isEmptyObject(v)?(g.error(b.undefinedColors),!1):!0},async:function(e){n.async?setTimeout(e,0):e()},getMetadata:function(){g.debug("Grabbing metadata"),c=f.data("image")||n.image||o,l=f.data("name")||n.name||t,u=n.width||f.width(),d=n.height||f.height(),(0===u||0===d)&&g.error(b.undefinedSize)},initialize:function(){g.debug("Initializing with colors",v),g.checkPreconditions()&&g.async(function(){g.getMetadata(),g.canvas.create(),g.draw.image(function(){g.draw.colors(),g.canvas.merge()}),f.data("module-"+x,g)})},redraw:function(){g.debug("Redrawing image"),g.async(function(){g.canvas.clear(),g.draw.colors(),g.canvas.merge()})},change:{color:function(e,t){return g.debug("Changing color",e),v[e]===o?(g.error(b.missingColor),!1):(v[e]=t,g.redraw(),o)}},canvas:{create:function(){g.debug("Creating canvases"),m.width=u,m.height=d,p.width=u,p.height=d,h.width=u,h.height=d,a=m.getContext("2d"),r=p.getContext("2d"),s=h.getContext("2d"),f.append(m),a=f.children("canvas")[0].getContext("2d")},clear:function(){g.debug("Clearing canvas"),s.fillStyle="#FFFFFF",s.fillRect(0,0,u,d)},merge:function(){return e.isFunction(a.blendOnto)?(a.putImageData(r.getImageData(0,0,u,d),0,0),s.blendOnto(a,"multiply"),o):(g.error(b.missingPlugin),o)}},draw:{image:function(e){g.debug("Drawing image"),e=e||function(){},c?(y.src=c,y.onload=function(){r.drawImage(y,0,0),e()}):(g.error(b.noImage),e())},colors:function(){g.debug("Drawing color overlays",v),e.each(v,function(e,t){n.onDraw(s,l,e,t)})}},debug:function(e,t){n.debug&&(t!==o?console.info(n.moduleName+": "+e,t):console.info(n.moduleName+": "+e))},error:function(e){console.warn(n.moduleName+": "+e)},invoke:function(t,i,a){var r;return a=a||Array.prototype.slice.call(arguments,2),"string"==typeof t&&w!==o&&(t=t.split("."),e.each(t,function(t,o){return e.isPlainObject(w[o])?(w=w[o],!0):e.isFunction(w[o])?(r=w[o],!0):(g.error(n.errors.method),!1)})),e.isFunction(r)?r.apply(i,a):!1}},w!==o&&i?("invoke"==i[0]&&(i=Array.prototype.slice.call(i,1)),g.invoke(i[0],this,Array.prototype.slice.call(i,1))):(g.initialize(),o)}),this},e.fn.colorize.settings={moduleName:"Image Colorizer",debug:!0,namespace:"colorize",onDraw:function(){},async:!0,colors:{},metadata:{image:"image",name:"name"},errors:{noImage:"No tracing image specified",undefinedColors:"No default colors specified.",missingColor:"Attempted to change color that does not exist",missingPlugin:"Blend onto plug-in must be included",undefinedHeight:"The width or height of image canvas could not be automatically determined. Please specify a height."}}})(jQuery,window,document);