(function(e,n,t,o){e.fn.colorize=function(n){var t=e.extend(!0,{},e.fn.colorize.settings,n),i=arguments||!1;return e(this).each(function(n){var a,r,s,c,l,u,d,g,m=e(this),f=e("<canvas />")[0],p=e("<canvas />")[0],h=e("<canvas />")[0],v=new Image,y=t.colors,b=(t.paths,t.namespace),x=t.errors,C=m.data("module-"+b);return g={checkPreconditions:function(){return g.debug("Checking pre-conditions"),!e.isPlainObject(y)||e.isEmptyObject(y)?(g.error(x.undefinedColors),!1):!0},async:function(e){t.async?setTimeout(e,0):e()},getMetadata:function(){g.debug("Grabbing metadata"),c=m.data("image")||t.image||o,l=m.data("name")||t.name||n,u=t.width||m.width(),d=t.height||m.height(),(0===u||0===d)&&g.error(x.undefinedSize)},initialize:function(){g.debug("Initializing with colors",y),g.checkPreconditions()&&g.async(function(){g.getMetadata(),g.canvas.create(),g.draw.image(function(){g.draw.colors(),g.canvas.merge()}),m.data("module-"+b,g)})},redraw:function(){g.debug("Redrawing image"),g.async(function(){g.canvas.clear(),g.draw.colors(),g.canvas.merge()})},change:{color:function(e,n){return g.debug("Changing color",e),y[e]===o?(g.error(x.missingColor),!1):(y[e]=n,g.redraw(),o)}},canvas:{create:function(){g.debug("Creating canvases"),f.width=u,f.height=d,p.width=u,p.height=d,h.width=u,h.height=d,a=f.getContext("2d"),r=p.getContext("2d"),s=h.getContext("2d"),m.append(f),a=m.children("canvas")[0].getContext("2d")},clear:function(){g.debug("Clearing canvas"),s.fillStyle="#FFFFFF",s.fillRect(0,0,u,d)},merge:function(){return e.isFunction(a.blendOnto)?(a.putImageData(r.getImageData(0,0,u,d),0,0),s.blendOnto(a,"multiply"),o):(g.error(x.missingPlugin),o)}},draw:{image:function(e){g.debug("Drawing image"),e=e||function(){},c?(v.src=c,v.onload=function(){r.drawImage(v,0,0),e()}):(g.error(x.noImage),e())},colors:function(){g.debug("Drawing color overlays",y),e.each(y,function(e,n){t.onDraw(s,l,e,n)})}},debug:function(e,n){t.debug&&(n!==o?console.info(t.moduleName+": "+e,n):console.info(t.moduleName+": "+e))},error:function(e){console.warn(t.moduleName+": "+e)},invoke:function(n,i,a){var r;return a=a||Array.prototype.slice.call(arguments,2),"string"==typeof n&&C!==o&&(n=n.split("."),e.each(n,function(n,o){return e.isPlainObject(C[o])?(C=C[o],!0):e.isFunction(C[o])?(r=C[o],!0):(g.error(t.errors.method),!1)})),e.isFunction(r)?r.apply(i,a):!1}},C!==o&&i?("invoke"==i[0]&&(i=Array.prototype.slice.call(i,1)),g.invoke(i[0],this,Array.prototype.slice.call(i,1))):(g.initialize(),o)}),this},e.fn.colorize.settings={moduleName:"Image Colorizer",debug:!0,namespace:"colorize",onDraw:function(){},async:!0,colors:{},metadata:{image:"image",name:"name"},errors:{noImage:"No tracing image specified",undefinedColors:"No default colors specified.",missingColor:"Attempted to change color that does not exist",missingPlugin:"Blend onto plug-in must be included",undefinedHeight:"The width or height of image canvas could not be automatically determined. Please specify a height."}}})(jQuery,window,document);