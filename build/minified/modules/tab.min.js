(function(e,t,n,o){e.fn.tabNavigation=function(n){var i,a,r,s,c,l=e.extend(!0,{},e.fn.tabNavigation.settings,n),u=e(this),d=e(l.context).find(l.selector.tabs),m=!0,f={},p=0,g=l.className,h=l.metadata,v=l.namespace,b=l.errors,y=u.data("module"),x=arguments[0],w=y!==o&&"string"==typeof x,C=[].slice.call(arguments,1);return s={initialize:function(){if(s.debug("Initializing Tabs",u),l.history){if(e.address===o)return s.error(b.state),!1;if(l.path===!1)return s.error(b.path),!1;s.verbose("Address library found adding state change event"),e.address.state(l.path).change(s.event.history.change)}e.isWindow(u.get(0))||u.on("click."+v,s.event.click),u.data("module",s)},destroy:function(){s.debug("Destroying tabs",u),u.off("."+v)},event:{click:function(){s.debug("Navigation clicked");var t=e(this).data(h.tab);t!==o?t!==i&&(l.history?e.address.value(t):s.change(t)):s.debug("No tab specified")},history:{change:function(t){var n=t.pathNames.join("/")||s.get.initialPath(),i=l.templates.determineTitle(n)||!1;s.debug("History change event",n,t),r=t,n!==o&&s.change(n),i&&e.address.title(i)}}},refresh:function(){i&&(s.debug("Refreshing tab",i),s.change(i))},cache:{read:function(e){return e!==o?f[e]:f},add:function(e,t){e=e||i,s.debug("Adding cached content for",e),f[e]=t},remove:function(e){e=e||i,s.debug("Removing cached content for",e),delete f[e]}},change:function(n){var c=s.get.defaultPathArray(n);s.deactivate.all(),e.each(c,function(u,d){var p=c.slice(0,u+1),g=s.utils.arrayToPath(p),h=s.utils.last(c)==g,v=s.is.tab(g),b=!v,y=t.history&&t.history.pushState,x=y&&l.ignoreFirstLoad&&m,w=e.isPlainObject(l.apiSettings),C=s.get.tabElement(g);return s.verbose("Looking for tab",d),b?(s.verbose("Tab is not found, assuming it is a parameter",d),!0):(v&&(s.verbose("Tab was found",d),i=g,a=s.utils.filterArray(c,p),h&&w?x?(s.debug("Ignoring remote content on first tab load",g),m=!1,f[n]=C.html(),s.activate.all(g),e.proxy(l.onTabInit,C)(g,a,r)):(s.activate.navigation(g),s.content.fetch(g,l.onTabLoad)):(s.debug("Opened tab",g),s.activate.all(g),e.proxy(l.onTabLoad,C)(g,a,r))),o)})},content:{fetch:function(t){var n=s.get.tabElement(t),c=f[t]||!1,u={dataType:"html",stateContext:n,success:function(o){f[t]=o,s.content.update(t,o),t==i?(s.debug("Content loaded",t),s.activate.tab(t)):s.debug("Content loaded in background",t),e.proxy(l.onTabInit,n)(t,a,r)},urlData:{tab:t}},d=n.data(h.promise)||!1,m=d&&"pending"===d.state();l.cache&&c?(s.debug("Showing existing content",t),s.activate.tab(t),e.proxy(l.onTabLoad,n)(t,a,r)):m?(s.debug("Content is already loading",t),n.addClass(g.loading)):e.api!==o?(s.debug("Retrieving content",t),e.api(e.extend(!0,{},l.apiSettings,u))):s.error(b.api)},update:function(e,t){s.debug("Updating html for",e);var n=s.get.tabElement(e);n.html(t)}},activate:{all:function(e){s.activate.tab(e),s.activate.navigation(e)},tab:function(e){var t=s.get.tabElement(e);s.verbose("Showing tab content for",t),t.addClass(g.active)},navigation:function(e){var t=s.get.navElement(e);s.verbose("Activating tab navigation for",t),t.addClass(g.active)}},deactivate:{all:function(){s.deactivate.navigation(),s.deactivate.tabs()},navigation:function(){u.removeClass(g.active)},tabs:function(){d.removeClass(g.active+" "+g.loading)}},is:{tab:function(e){return s.get.tabElement(e).size()>0}},get:{initialPath:function(){return u.eq(0).data(h.tab)||d.eq(0).data(h.tab)},defaultPathArray:function(e){return s.utils.pathToArray(s.get.defaultPath(e))},defaultPath:function(e){var t=u.filter("[data-"+h.tab+'^="'+e+'/"]').eq(0),n=t.data(h.tab)||!1;if(n){if(s.debug("Found default tab",n),l.maxDepth>p)return p++,s.get.defaultPath(n);s.error(b.recursion)}return p=0,e},navElement:function(e){return e=e||i,u.filter("[data-"+h.tab+'="'+e+'"]')},tabElement:function(e){var t,n,o,a;return e=e||i,o=s.utils.pathToArray(e),a=s.utils.last(o),t=d.filter("[data-"+h.tab+'="'+a+'"]'),n=d.filter("[data-"+h.tab+'="'+e+'"]'),t.size()>0?t:n},tab:function(){return i}},utils:{filterArray:function(t,n){return e.grep(t,function(t){return-1==e.inArray(t,n)})},last:function(t){return e.isArray(t)?t[t.length-1]:!1},pathToArray:function(e){return e===o&&(e=i),"string"==typeof e?e.split("/"):[e]},arrayToPath:function(t){return e.isArray(t)?t.join("/"):!1}},setting:function(e,t){return t===o?l[e]:(l[e]=t,o)},verbose:function(){l.verbose&&s.debug.apply(this,arguments)},debug:function(){var e=[],t=l.moduleName+": "+arguments[0],n=[].slice.call(arguments,1),o=console.info||console.log||function(){};o=Function.prototype.bind.call(o,console),l.debug&&(e.push(t),o.apply(console,e.concat(n)))},error:function(){var e=[],t=l.moduleName+": "+arguments[0],n=[].slice.call(arguments,1),o=console.warn||console.log||function(){};o=Function.prototype.bind.call(o,console),l.debug&&(e.push(t),e.concat(n),o.apply(console,e.concat(n)))},invoke:function(t,n,i){var a,r;return i=i||[].slice.call(arguments,2),"string"==typeof t&&y!==o&&(t=t.split("."),a=t.length-1,e.each(t,function(t,n){return e.isPlainObject(y[n])&&t!=a?(y=y[n],!0):y[n]!==o?(r=y[n],!0):(s.error(l.errors.method),!1)})),e.isFunction(r)?r.apply(n,i):r}},w?c=s.invoke(x,this,C):s.initialize(),c!==o?c:this},e.tabNavigation=function(n){e(t).tabNavigation(n)},e.fn.tabNavigation.settings={moduleName:"Tab Module",verbose:!1,debug:!0,namespace:"tab",onTabInit:function(){},onTabLoad:function(){},templates:{determineTitle:function(){}},history:!1,path:!1,context:"body",maxDepth:25,ignoreFirstLoad:!0,alwaysRefresh:!1,cache:!0,apiSettings:!1,errors:{api:"You attempted to load content without API module",noContent:"The tab you specified is missing a content url.",method:"The method you called is not defined",state:"The state library has not been initialized",missingTab:"Missing tab: ",path:"History enabled, but no path was specified",recursion:"Max recursive depth reached"},metadata:{tab:"tab",loaded:"loaded",promise:"promise"},className:{loading:"loading",active:"active"},selector:{tabs:".tab"}}})(jQuery,window,document);