(function(e,t,n,o){e.fn.searchPrompt=function(n,i){var s,a=e.extend(!0,{},e.fn.searchPrompt.settings,i),r=arguments[0],l=[].slice.call(arguments,1);return e(this).each(function(){var i,c=e(this),u=c.find(a.selector.searchPrompt),d=c.find(a.selector.searchButton),f=c.find(a.selector.searchResults),p=(c.find(a.selector.result),c.find(a.selector.category),c.find(a.selector.emptyResult),c.find(a.selector.resultPage),this),m=(c.selector||"",c.data("module-"+a.namespace)),g=m!==o&&"string"==typeof r,h=a.className,v=a.namespace,b=a.errors;i={initialize:function(){var e=u[0],t=e.oninput!==o?"input":e.onpropertychange!==o?"propertychange":"keyup";u.on("focus."+v,i.event.focus).on("blur."+v,i.event.blur).on("keydown."+v,i.handleKeyboard),a.automatic&&u.on(t+"."+v,i.search.throttle),d.on("click."+v,i.search.query),f.on("click."+v,a.selector.result,i.results.select),c.data("module-"+v,i)},event:{focus:function(){c.addClass(h.focus),i.results.show()},blur:function(){i.search.cancel(),c.removeClass(h.focus),i.results.hide()}},handleKeyboard:function(t){var n,o=c.find(a.selector.result),s=c.find(a.selector.category),r=t.which,l={backspace:8,enter:13,escape:27,upArrow:38,downArrow:40},p=h.active,m=o.index(o.filter("."+p)),g=o.size();if(r==l.escape&&u.trigger("blur"),f.filter(":visible").size()>0)if(r==l.enter){if(o.filter("."+p).exists())return e.proxy(i.results.select,o.filter("."+p))(),t.preventDefault(),!1}else r==l.upArrow?(n=0>m-1?m:m-1,s.removeClass(p),o.removeClass(p).eq(n).addClass(p).closest(s).addClass(p),t.preventDefault()):r==l.downArrow&&(n=m+1>=g?m:m+1,s.removeClass(p),o.removeClass(p).eq(n).addClass(p).closest(s).addClass(p),t.preventDefault());else r==l.enter&&(i.search.query(),d.addClass(h.down),u.one("keyup",function(){d.removeClass(h.down)}))},search:{cancel:function(){var e=c.data("xhr")||!1;e&&"resolved"!=e.state()&&e.abort()},throttle:function(){var e,t=u.val(),n=t.length;clearTimeout(c.data("timer")),n>=a.minCharacters?(e=setTimeout(i.search.query,a.searchThrottle),c.data("timer",e)):i.results.hide()},query:function(){var t=u.val(),o=i.search.cache.read(t);o?(i.debug("Reading result for '"+t+"' from cache"),i.results.add(o)):(i.debug("Querying for '"+t+"'"),"object"==typeof n?i.search.local(t):i.search.remote(t),e.proxy(a.onSearchQuery,c)(t))},local:function(t){var o,s=[],r=[],l=e.isArray(a.searchFields)?a.searchFields:[a.searchFields],u=RegExp("(?:s|^)"+t,"i"),d=RegExp(t,"i");c.addClass(h.loading),e.each(l,function(t,o){e.each(n,function(t,n){"string"==typeof n[o]&&-1==e.inArray(n,s)&&-1==e.inArray(n,r)&&(u.test(n[o])?s.push(n):d.test(n[o])&&r.push(n))})}),o=i.results.generate({results:e.merge(s,r)}),c.removeClass(h.loading),i.search.cache.write(t,o),i.results.add(o)},remote:function(t){var s,r=c.data("xhr")!==o?c.data("xhr"):!1,l={stateContext:c,url:n,urlData:{query:t},success:function(e){s=i.results.generate(e),i.search.cache.write(t,s),i.results.add(s)},failure:i.error};r&&"resolved"!=r.state()&&r.abort(),e.extend(!0,l,a.apiSettings),e.api(l)},cache:{read:function(e){var t=c.data("cache");return a.cache&&"object"==typeof t&&t[e]!==o?t[e]:!1},write:function(e,t){var n=c.data("cache")!==o?c.data("cache"):{};n[e]=t,c.data("cache",n)}}},results:{generate:function(t){i.debug("Generating html from response",t);var n=a.templates[a.type],o="";return e.isPlainObject(t.results)&&!e.isEmptyObject(t.results)||e.isArray(t.results)&&t.results.length>0?(a.maxResults>0&&(t.results=e.makeArray(t.results).slice(0,a.maxResults)),t.results.length>0&&(e.isFunction(n)?o=n(t):i.error(b.noTemplate,!1))):o=i.message(b.noResults,"empty"),e.proxy(a.onSearchResults,c)(t),o},add:function(t){("default"==a.onResultsAdd||"default"==e.proxy(a.onResultsAdd,f)(t))&&f.html(t),i.results.show()},show:function(){0===f.filter(":visible").size()&&u.filter(":focus").size()>0&&""!==f.html()&&(f.stop().fadeIn(200),e.proxy(a.onResultsOpen,f)())},hide:function(){f.filter(":visible").size()>0&&(f.stop().fadeOut(200),e.proxy(a.onResultsClose,f)())},followLink:function(){},select:function(n){i.debug("Search result selected");var o=e(this),s=o.find(".title"),r=s.html();if("default"==a.onSelect||"default"==e.proxy(a.onSelect,this)(n)){var l=o.find("a[href]").eq(0),c=l.attr("href"),d=l.attr("target");try{i.results.hide(),u.val(r),"_blank"==d||n.ctrlKey?t.open(c):t.location.href=c}catch(f){}}}},setting:function(e,t){return t===o?a[e]:(a[e]=t,o)},debug:function(){var e=[],t=a.moduleName+": "+arguments[0],n=[].slice.call(arguments,1),o=console.info||console.log||function(){};o=Function.prototype.bind.call(o,console),a.debug&&(e.push(t),o.apply(console,e.concat(n)))},message:function(e,t){return t=t||"standard",i.results.add(a.templates.message(e,t)),a.templates.message(e,t)},error:function(e,t){t=t!==o?t:!0,console.warn(a.moduleName+": "+e),t&&e!==o&&i.message(e,"error")},invoke:function(t,n,s){var a,r;return s=s||[].slice.call(arguments,2),"string"==typeof t&&m!==o&&(t=t.split("."),a=t.length-1,e.each(t,function(t,n){return e.isPlainObject(m[n])&&t!=a?(m=m[n],!0):m[n]!==o?(r=m[n],!0):(i.error(b.method),!1)})),e.isFunction(r)?r.apply(n,s):r}},g?s=i.invoke(r,p,l):i.initialize()}),s!==o?s:this},e.fn.searchPrompt.settings={moduleName:"Search Module",debug:!0,namespace:"search",onSelect:"default",onResultsAdd:"default",onSearchQuery:function(){},onSearchResults:function(){},onResultsOpen:function(){},onResultsClose:function(){},automatic:"true",type:"simple",minCharacters:3,searchThrottle:300,maxResults:7,cache:!0,searchFields:["title","description"],apiSettings:{},className:{active:"active",down:"down",focus:"focus",empty:"empty",loading:"loading"},errors:{noResults:"Your search returned no results",logging:"Error in debug logging, exiting.",noTemplate:"A valid template name was not specified.",serverError:"There was an issue with querying the server.",method:"The method you called is not defined."},selector:{searchPrompt:".prompt",searchButton:".search.button",searchResults:".results",category:".category",result:".result",emptyResult:".results .message",resultPage:".results .page"},templates:{message:function(e,t){var n="";return e!==o&&t!==o&&(n+='<div class="message '+t+'">'+'<div class="text">',n+="empty"==t?"<h2>No Results</h2><p>"+e+"</p>":' <div class="text">'+e+"</div>",n+="</div>"),n},categories:function(t){var n="";return t.results!==o?(e.each(t.results,function(t,i){i.results!==o&&i.results.length>0&&(n+='<div class="category"><div class="name">'+i.name+"</div>"+"<ul>",e.each(i.results,function(e,t){n+='<li class="result">',n+='<a href="'+t.url+'"></a>',t.image!==o&&(n+='<div class="image"> <img src="'+t.image+'">'+"</div>"),n+=t.image!==o?'<div class="indented info">':'<div class="info">',t.price!==o&&(n+='<div class="price">'+t.price+"</div>"),t.title!==o&&(n+='<div class="title">'+t.title+"</div>"),t.description!==o&&(n+='<div class="description">'+t.description+"</div>"),n+="</div></li>"}),n+="</ul></div>")}),t.resultPage&&(n+='<a href="'+t.resultPage.url+'" class="result-page">'+t.resultPage.text+"</a>"),n):!1},simple:function(t){var n="";return t.results!==o?(n+="<ul>",e.each(t.results,function(e,t){n+='<li class="result">',t.url!==o&&(n+='<a href="'+t.url+'"></a>'),t.image!==o&&(n+='<div class="image"> <img src="'+t.image+'">'+"</div>"),n+=t.image!==o?'<div class="indented info">':'<div class="info">',t.price!==o&&(n+='<div class="price">'+t.price+"</div>"),t.title!==o&&(n+='<div class="title">'+t.title+"</div>"),t.description!==o&&(n+='<div class="description">'+t.description+"</div>"),n+="</div></li>"}),n+="</ul>",t.resultPage&&(n+='<a href="'+t.resultPage.url+'" class="result-page">'+t.resultPage.text+"</a>"),n):!1}}}})(jQuery,window,document);